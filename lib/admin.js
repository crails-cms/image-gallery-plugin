(()=>{"use strict";class t extends Cms.Dialog{constructor(t){super();const e=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),i=document.createElement("label"),c=document.createElement("label"),r=document.createElement("button");Cms.i18n.ready.then((function(){n.textContent=Cms.i18n.t("admin.page-editor.components.gallery"),i.textContent=Cms.i18n.t("admin.page-editor.properties.columns"),c.textContent=Cms.i18n.t("admin.page-editor.properties.images"),r.textContent=Cms.i18n.t("admin.confirm")})),this.columnsInput=document.createElement("input"),this.columnsInput.type="number",this.sourcesInput=document.createElement("input"),this.sourcesInput.type="hidden",Cms.Style.ready.then((function(){n.classList.add("popup-title"),Cms.Style.apply("form",e),Cms.Style.apply("formGroup",s,o),Cms.Style.apply("confirmButton",r),Cms.Style.apply("formInput",this.columnsInput)})),s.appendChild(i),s.appendChild(this.columnsInput),o.appendChild(c),o.appendChild(this.sourcesInput),e.appendChild(s),e.appendChild(o),e.appendChild(r),this.popup.appendChild(n),this.popup.appendChild(e),this.imagePicker=new Cms.inputs.MultiplePictureInput(this.sourcesInput),r.addEventListener("click",t)}get columns(){return this.columnsInput.value}set columns(t){this.columnsInput.value=t}get sources(){return this.sourcesInput.value}set sources(t){this.sourcesInput.value=t,this.imagePicker.reloadInputValue()}}class e extends Cms.CKEditor.Plugin{static toolName="cmsGallery";init(){this.defineSchema(),this.defineConverters(),this.editor.ui.componentFactory.add(this.constructor.toolName,this.createButton.bind(this))}defineSchema(){this.editor.model.schema.register("cmsGallery",{isObject:!0,allowWhere:"$block",allowAttributes:["columns","sources"]})}defineConverters(){const t=this.editor.conversion;t.for("upcast").elementToElement({view:{name:"figure",classes:"blocks-gallery-grid"},model:(t,{writer:e})=>this.createModel(t,e)}),t.for("dataDowncast").elementToElement({model:"cmsGallery",view:(t,{writer:e})=>this.createElement(t,e)}),t.for("editingDowncast").elementToElement({model:"cmsGallery",view:(t,{writer:e})=>this.createElement(t,e,!0)})}createModel(t,e){return e.createElement("cmsGallery",function(t){return{columns:t.getAttribute("data-columns"),sources:t.getAttribute("data-sources")}}(t))}createElement(t,e,n=!1){const s=this.openEditor.bind(this,t),o=function(t){return{"data-columns":t.getAttribute("columns"),"data-sources":t.getAttribute("sources")}}(t),i=e.createContainerElement("figure",o),c=e.createRawElement("ul",{class:"blocks-gallery-grid","data-width":o["data-columns"],style:n?"display:flex":""},(function(t){JSON.parse(o["data-sources"]).forEach((e=>{const s=function(t){const e=document.createElement("li"),n=document.createElement("figure"),s=document.createElement("img");return s.src=t,n.appendChild(s),e.appendChild(n),e}(n?e.miniature_url:e.url);t.appendChild(s)})),n&&t.addEventListener("click",(function(){s(t)}))}));return e.insert(e.createPositionAt(i,0),c),Cms.CKEditor.toWidget(i,e,{label:"gallery widget"})}openEditor(e,n){const s=new t((()=>{const{sources:t,columns:n}=s;e._setAttribute("columns",s.columns),e._setAttribute("sources",s.sources),s.close()}));s.columns=e.getAttribute("columns"),s.sources=e.getAttribute("sources"),s.open(),window.toto=s,window.tintin=e}createButton(){const t=new Cms.CKEditor.ButtonView;return t.set({label:"admin.image-library",icon:'<?xml version="1.0" encoding="iso-8859-1"?>\n\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e\n<svg fill="#000000" height="800px" width="800px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" \n\t viewBox="0 0 512.2 512.2" xml:space="preserve">\n<g>\n\t<g>\n\t\t<g>\n\t\t\t<path d="M495.1,38.4H85.5c-9.4,0-17.1,7.6-17.1,17.1v17.1H51.3c-9.4,0-17.1,7.6-17.1,17.1v17.1H17.1c-9.4,0-17.1,7.6-17.1,17.1\n\t\t\t\tv332.8c0,9.4,7.6,17.1,17.1,17.1h409.6c9.4,0,17.1-7.6,17.1-17.1v-17.1h17.1c9.4,0,17.1-7.6,17.1-17.1v-17.1h17.1\n\t\t\t\tc9.4,0,17.1-7.6,17.1-17.1V55.5C512.2,46,504.6,38.4,495.1,38.4z M426.8,314.4l-44.7-51.2c-3.4-3.9-9.4-3.9-12.9,0l-54,61.8\n\t\t\t\tL168,194.2c-3.2-2.9-8.1-2.9-11.3,0L17.3,318.1V132.3c0-4.7,3.8-8.5,8.5-8.5h392.5c4.7,0,8.5,3.8,8.5,8.5V314.4z M452.5,422.4\n\t\t\t\tH444V123.7c0-9.4-7.6-17.1-17.1-17.1H51.4v-8.5c0-4.7,3.8-8.5,8.5-8.5h392.5c4.7,0,8.5,3.8,8.5,8.5l0.1,315.8\n\t\t\t\tC461,418.6,457.2,422.4,452.5,422.4z M486.6,388.2h-8.5V89.6c0-9.4-7.6-17.1-17.1-17.1H85.5V64c0-4.7,3.8-8.5,8.5-8.5h392.5\n\t\t\t\tc4.7,0,8.5,3.8,8.5,8.5v315.7h0.1C495.1,384.4,491.3,388.2,486.6,388.2z"/>\n\t\t\t<path d="M307.4,174.9c-18.8,0-34.1,15.3-34.1,34.1c0,18.8,15.3,34.1,34.1,34.1c18.8,0,34.1-15.3,34.1-34.1\n\t\t\t\tC341.5,190.2,326.2,174.9,307.4,174.9z"/>\n\t\t</g>\n\t</g>\n</g>\n</svg>\n'}),t.on("execute",this.buttonClicked.bind(this)),t}buttonClicked(){const e=new t((()=>{const{sources:t,columns:n}=e;this.appendGallery({sources:t,columns:n}),e.close()}));e.open()}appendGallery(t){try{console.log("Append gallery with data",t),this.editor.model.change((e=>{this.editor.model.insertContent(e.createElement("cmsGallery",t))}))}catch(t){console.error("Failed",t)}}}window.customCKEditorPlugins||=[],window.customCKEditorPlugins.push(e)})();